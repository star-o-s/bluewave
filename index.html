<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Blue wave form.</title>
<style>
:root{
  --bg:#9b9b9b;
  --blue:#09a0ff;
  --white:#ffffff;
}
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:var(--bg);
  font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
.player{
  width:90%;
  max-width:1200px;
  display: flex;
    flex-direction: column;
    align-items: center; /* centra horizontalmente */
    justify-content: center; /* centra verticalmente si es necesario */
}

@media (max-width: 600px) {
  .pp-button {
    padding: 35px; /* botones más pequeños en móvil */
  }
  .file-btn {
    padding: 20px;
    font-size: 12px;
  }
  .wave-wrap svg {
    height: 1020px;
  }
}
.controls{
  display:flex;
  align-items:center;
  gap:18px;
  /*margin-bottom:12px;*/
}
.pp-button{
    background:rgba(115, 115, 115,0.5);
    padding:50px;
    border-radius:1000px;
    color:#fff;
    cursor:pointer;
    border:1px solid rgba(255, 255, 255, 1);
	/*box-shadow: 0 1px 12px rgba(0,0,0,0.3);*/
}
.pp-button svg{
  width:18px;
  height:18px;
}
.file-load{
  display:flex;
  gap:8px;
  align-items:center;
  color:#fff;
  
}
.file-load input[type=file]{display:none;}
.file-btn{
  background:rgba(105,105,105,0.5);
  padding:50px;
  border-radius:1000px;
  color:#fff;
  font-size: 14px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,1);
  margin-top: 50px;
}
.wave-wrap{
  width:100%;
  overflow:hidden;
  position:relative;
}
.wave-wrap svg{
  width:100%;
  height:200px;
}
.caption{
  color:#eee;
  font-size:13px;
  opacity:0.9;
  margin-top:10px;
}
#progressMask {
  fill: var(--blue);
  pointer-events:none;
  mix-blend-mode:screen;
}
</style>
</head>
<body>

<div class="player">
  <div class="controls">
    <div class="pp-button" id="playPause" aria-pressed="false" title="Play/Pause">
      <svg viewBox="0 0 36 36" width="36" height="36">
        <!-- Pause -->
        <g id="pauseIcon" fill="white">
          <rect x="8" y="4" width="6" height="28" rx="3"></rect>
          <rect x="22" y="4" width="6" height="28" rx="3"></rect>
        </g>
        <!-- Play -->
        <g id="playIcon" fill="white" style="display:none">
          <path d="M12 6 L28 18 L12 30 Z"></path>
        </g>
      </svg>
    </div>
  </div>
  
  
  <div class="wave-wrap">
    <svg id="waveSVG" role="img" aria-label="Forma de onda">
      <defs>
        <clipPath id="progressClip">
          <rect id="progressRect" x="0" y="0" width="0" height="140"/>
        </clipPath>
        <filter id="barShadow" x="-50%" y="-50%" width="200%" height="200%">
          <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="black" flood-opacity="0"/>
        </filter>
      </defs>
      <g id="barsInactive" transform="translate(24,0)" filter="url(#barShadow)"></g>
      <g id="barsActive" transform="translate(24,0)" clip-path="url(#progressClip)" filter="url(#barShadow)"></g>
	  
    </svg>
  </div>
  
  
    <label class="file-btn" for="audioFile">Up</label>
    <input type="file" id="audioFile" accept="audio/*" style="display:none">
  
  
  <div id="fileName" style="font-size:13px;color:#fff;opacity:0.9;display:none">No file</div>
</div>

<script>
const BAR_WIDTH = 8;
const SPACING = 9;
const MAX_HEIGHT = 137;
const ACTIVE_FILL = '#09a0ff';
const INACTIVE_FILL = 'transparent';
const STROKE_COLOR = '#fefefe';
const STROKE_W = 1;

const barsInactive = document.getElementById('barsInactive');
const barsActive = document.getElementById('barsActive');
const waveSVG = document.getElementById('waveSVG');
const playPauseBtn = document.getElementById('playPause');
const pauseIcon = document.getElementById('pauseIcon');
const playIcon = document.getElementById('playIcon');
const audioInput = document.getElementById('audioFile');
const fileNameLabel = document.getElementById('fileName');
const progressRect = document.getElementById('progressRect');

let audio = new Audio();
let waveform = [];
let isPlaying = false;
let animationId = null;
let totalWidth = 0;

// Crear barras según waveform
function createBars(data){
  barsInactive.innerHTML='';
  barsActive.innerHTML='';
  waveform = data;
  totalWidth = data.length*(BAR_WIDTH+SPACING);
  
  data.forEach((v,i)=>{
    const x = i*(BAR_WIDTH+SPACING);
    const height = Math.max(v * MAX_HEIGHT, 25); // escala amplitud
    const y = MAX_HEIGHT - height;

    // Inactive
    const rect1 = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect1.setAttribute('x', x);
    rect1.setAttribute('y', y);
    rect1.setAttribute('width', 13);
    rect1.setAttribute('height', height);
    rect1.setAttribute('rx', BAR_WIDTH/1.2);
    rect1.setAttribute('ry', BAR_WIDTH/1.2);
    rect1.setAttribute('fill', INACTIVE_FILL);
    rect1.setAttribute('stroke', STROKE_COLOR);
    rect1.setAttribute('stroke-width', STROKE_W);
    barsInactive.appendChild(rect1);

    // Active
    const rect2 = rect1.cloneNode();
    rect2.setAttribute('fill', ACTIVE_FILL);
    barsActive.appendChild(rect2);
  });

  waveSVG.setAttribute('viewBox', `0 0 ${totalWidth + 48} 140`);
}

// Pintar progreso fluido
function drawProgress(){
  const progress = audio.currentTime / audio.duration || 0;
  progressRect.setAttribute('width', progress * totalWidth);
  if(!audio.paused) animationId = requestAnimationFrame(drawProgress);
}

// Cargar archivo y generar waveform
audioInput.addEventListener('change', async(e)=>{
  const file = e.target.files[0];
  if(!file) return;
  fileNameLabel.textContent = file.name;

  const arrayBuffer = await file.arrayBuffer();
  const ctx = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(1,44100*40,44100);
  const buffer = await ctx.decodeAudioData(arrayBuffer);
  const channelData = buffer.getChannelData(0);

  const samples = 82; // número de barras
  const step = Math.floor(channelData.length / samples);
  const data = [];
  for(let i=0;i<samples;i++){
    let sum=0;
    for(let j=0;j<step;j++) sum += Math.abs(channelData[i*step + j]);
    data.push(sum/step);
  }

  createBars(data);
  audio.src = URL.createObjectURL(file);
  audio.load();
  isPlaying = false;
  pauseIcon.style.display = 'block';
  playIcon.style.display = 'none';
  progressRect.setAttribute('width',0);
});

// Toggle play/pause
playPauseBtn.addEventListener('click',()=>{
  if(!audio.src) return;
  if(isPlaying){
    audio.pause();
    isPlaying = false;
    pauseIcon.style.display = 'block';
    playIcon.style.display = 'none';
  }else{
    audio.play();
    isPlaying = true;
    pauseIcon.style.display = 'none';
    playIcon.style.display = 'block';
    drawProgress();
  }
});

// Click sobre waveform para hacer seek
waveSVG.addEventListener('click', e=>{
  if(!audio.duration) return;
  const rect = waveSVG.getBoundingClientRect();
  const pct = (e.clientX - rect.left) / rect.width;
  audio.currentTime = pct * audio.duration;
  drawProgress();
});
</script>

</body>
</html>

